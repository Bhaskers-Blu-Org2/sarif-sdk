@ECHO OFF
SET BsoaEnlistment=C:\Code\bion\csharp\BSOA

PUSHD "%~dp0"

IF EXIST "%BsoaEnlistment%" (
  ECHO.
  ECHO Copying in BSOA Generator
  ECHO =========================
  XCOPY /HERKY "%BsoaEnlistment%\bin\Release\JschemaToBsoaSchema\netcoreapp3.1" "bin\"
  XCOPY /HERKY "%BsoaEnlistment%\bin\Release\BSOA.Generator\netcoreapp3.1" "bin\"
  XCOPY /HERKY "%~dp0Templates" "bin\Templates"
)

ECHO.
ECHO Regenerating SARIF SDK OM
ECHO =======================
bin\JschemaToBsoaSchema.exe "..\src\Sarif\Schemata\sarif-2.1.0-rtm.5.json" "Schemas\Sarif-2.1.0-rtm.5.schema.json"
bin\BSOA.Generator.exe "..\Schemas\Sarif-2.1.0-rtm.5.schema.json" "%~dp0..\src\Sarif\Autogenerated" "Templates\Sarif" "..\Schemas\Sarif.postReplacements.json"

POPD
PUSHD "%~dp0..\"

ECHO.
ECHO Installing BSOA Package References
ECHO ==================================
dotnet restore "src\Sarif\Sarif.csproj"  -f --no-cache

dotnet build "src\Sarif\Sarif.csproj" -c Release

POPD